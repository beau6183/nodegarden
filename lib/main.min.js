var Box=function(){function t(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s}return t.prototype.contains=function(t,i){return this.x<=t&&t<=this.x+this.w&&this.y<=i&&i<=this.y+this.h},t}(),Nodule=function(){function t(t,i,e,s,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===e&&(e=0),void 0===s&&(s=0),void 0===n&&(n=0),this.x=t,this.y=i,this.vx=e,this.vy=s,this._radius=0,this._mass=0,this.m=n}return Object.defineProperty(t.prototype,"m",{get:function(){return this._mass},set:function(t){t!==this._mass&&(this._mass=t,this._radius=Math.pow(3*t/(4*Math.PI),1/3))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0}),t}(),SpaceController=function(){function t(t){this.container=t,this.G=.00667408,this.initialMass=10,this.criticalMass=1e4,this.canvas=document.createElement("canvas"),this.canvas.id="nodegarden",this.ctx=this.canvas.getContext("2d"),this.container.appendChild(this.canvas),this.nodes=new Array(this.nodeCount)}return Object.defineProperty(t.prototype,"windowArea",{get:function(){return this.windowWidth*this.windowHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return window.devicePixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"windowWidth",{get:function(){return window.innerWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"windowHeight",{get:function(){return window.innerHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaledHeight",{get:function(){return this.windowHeight*this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaledWidth",{get:function(){return this.windowWidth*this.pixelRatio},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nodeCount",{get:function(){return Math.sqrt(this.scaledHeight*this.scaledWidth/72)/this.pixelRatio|0},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t,i;for(this.canvas.width=this.scaledWidth,this.canvas.height=this.scaledHeight,this.nodes.length=this.nodeCount,console.log({nodes:this.nodeCount,pxr:this.pixelRatio}),1!==this.pixelRatio&&(this.canvas.style.transform="scale("+1/this.pixelRatio+")",this.canvas.style.transformOrigin="0 0"),t=0,i=this.nodes.length;i>t;t++)this.nodes[t]||(this.nodes[t]=this.createNode());this.renderRequest&&window.cancelAnimationFrame(this.renderRequest),this.renderRequest=window.requestAnimationFrame(this.render.bind(this))},t.prototype.createNode=function(t){return void 0===t&&(t=null),t?(t.x=Math.random()*this.scaledWidth,t.y=Math.random()*this.scaledHeight,t.vx=1*Math.random()-.5,t.vy=1*Math.random()-.5,t.m=this.initialMass):t=new Nodule(Math.random()*this.scaledWidth,Math.random()*this.scaledHeight,1*Math.random()-.5,1*Math.random()-.5,this.initialMass),t},t.prototype.render=function(){var t,i,e,s,n,a,h,o,r,d,c,l,m;for(this.renderRequest=requestAnimationFrame(this.render.bind(this)),this.ctx.fillStyle="rgba(255, 255, 255, 0.1)",this.ctx.fillRect(0,0,this.scaledWidth,this.scaledHeight),o=0,d=this.nodes.length-1;d>o;o++)for(r=o+1;d+1>r;r++)c=this.nodes[o],l=this.nodes[r],h={x:l.x-c.x,y:l.y-c.y},t=Math.sqrt(Math.pow(h.x,2)+Math.pow(h.y,2)),t<c.radius+l.radius?(c.m<=l.m&&(c.x=Math.random()*this.scaledWidth,c.y=Math.random()*this.scaledHeight,l.vx+=c.vx*(c.m/l.m),l.vy+=c.vy*(c.m/l.m),c.vx=1*Math.random()-.5,c.vy=1*Math.random()-.5,l.m+=c.m,l.m>this.criticalMass&&(l.m=this.initialMass),c.m=this.initialMass),l.m<=c.m&&(l.x=Math.random()*this.scaledWidth,l.y=Math.random()*this.scaledHeight,c.vx+=l.vx*(l.m/c.m),c.vy+=l.vy*(l.m/c.m),l.vx=1*Math.random()-.5,l.vy=1*Math.random()-.5,c.m+=l.m,c.m>this.criticalMass&&(c.m=this.initialMass),l.m=this.initialMass)):(s={x:h.x/t,y:h.y/t},n=this.G*(c.m*l.m/Math.pow(t,2)),isNaN(n)||(a={x:n*s.x,y:n*s.y},c.vx+=l.m/c.m*a.x,c.vy+=l.m/c.m*a.y,l.vx-=c.m/l.m*a.x,l.vy-=c.m/l.m*a.y));for(o=0,d=this.nodes.length;d>o;o++)m=this.nodes[o],this.ctx.beginPath(),this.ctx.fillStyle="rgba("+Math.floor(255*(m.m/this.criticalMass))+", 0, 0, 1)",this.ctx.arc(m.x,m.y,m.radius*this.pixelRatio,0,2*Math.PI),this.ctx.fill(),m.x+=m.vx,m.y+=m.vy,m.x<=0?(i=this.impactLoss(m.vx,m.vy,!0),e=1-.5*i,m.x=0,m.vx*=-e,m.vy*=e,m.y+=m.vy):m.x>=this.scaledWidth&&(i=this.impactLoss(m.vx,m.vy,!0),e=1-.5*i,m.x=this.scaledWidth,m.vx*=-e,m.vy*=e,m.y+=m.vy),m.y<=0?(i=this.impactLoss(m.vx,m.vy,!1),e=1-.5*i,m.y=0,m.vy*=-e,m.vx*=e,m.x+=m.vx):m.y>=this.scaledHeight&&(i=this.impactLoss(m.vx,m.vy,!1),e=1-.5*i,m.y=this.scaledHeight,m.vy*=-e,m.vx*=e,m.x+=m.vx)},t.prototype.impactLoss=function(t,i,e){var s=Math.abs(Math.atan(i/t))*(180/Math.PI);return e&&(s=90-s),s/90},t}();